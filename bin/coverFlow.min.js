!function(e){function t(t,i){this.id=t,this.src=i,this.leftPosition=t*s,this._cfWrapper=e(".coverFlowWrapper"),this.checkDimensions()}function i(e,t){this.data=t.data,this.width=0,this._element=e,this._items=[],this._size=this.data.length,this._middle=Math.floor(this._size/2),o={infinite:t.infinite||!1,reflection:t.reflection||!1,perspective:t.perspective||600,buttons:t.buttons||!1,buttons_style:t.buttons_style||"dark",height:t.height||450},r=this._middle}var a,s=200,r=0,o={},n=1512;t.prototype={createDomItem:function(){return"<div class='coverFlowItem c"+this.id+"'>"+"<img src='"+this.src+"' />"+"<canvas></canvas>"+"</div>"},checkDimensions:function(){var t=this,i=new e.Deferred,a=new Image;return a.onload=function(){t._width=this.width,t._height=this.height,t.calculatedWidth=Math.round(this.width*o.height/this.height),i.resolve(t),o.reflection&&t.drawReflection(a)},a.src=this.src,i},drawReflection:function(e){var t,i=this._cfWrapper.find(".c"+this.id).find("canvas")[0],a=i.getContext("2d");i.height=o.height,i.width=this.calculatedWidth,a.drawImage(e,0,0,this.calculatedWidth,o.height),a.globalCompositeOperation="destination-out",t=a.createLinearGradient(0,0,0,o.height),t.addColorStop(0,"rgba(255,255,255,1)"),t.addColorStop(1,"rgba(255,255,255,0.5)"),a.fillStyle=t,a.rect(0,0,this.calculatedWidth,o.height),a.fill()}},i.prototype={createWrapper:function(){var e="<div class='coverFlowWrapper'></div>";this._element.addClass("coverFlow").html(e),this._wrapper=this._element.children(".coverFlowWrapper"),o.buttons&&this.createButtons(),this.registerScrollEvents(),this.registerTouchEvents(),a=this._element.width()},initElements:function(){for(var e="",i=this,s=0,n=this._size;n>s;s++){var c=new t(s,this.data[s]),l=c.createDomItem(),p=0;i._items.push(c),c.checkDimensions().then(function(e){p++,i.width+=e.calculatedWidth;var t=i._wrapper.find(".c"+e.id);e.id<r?t.addClass("leftItem").css({left:e.leftPosition,"z-index":i._size-(r-e.id)}):e.id>r?t.addClass("rightItem").css({left:e.leftPosition,"z-index":i._size-(e.id-r)}):t.addClass("highlight").css({left:e.leftPosition}),p==i._size&&i._wrapper.css({left:a/2-i._items[r].leftPosition,display:"block"})}),e+=l}this._wrapper.html(e),o.reflection||this._wrapper.find("canvas").remove()},repaintElements:function(){for(var e="highlight leftItem rightItem hidden",t=this._items[r].leftPosition,i=0,a=this._size;a>i;i++){var o=this._items[i],c=o.leftPosition,l=this._wrapper.find(".c"+o.id);c>t-n/2-2*s&&t+n/2+2*s>c?t>c?l.removeClass(e).addClass("leftItem").css("left",c).css("z-index",a-(r-o.id)):c>t?l.removeClass(e).addClass("rightItem").css("left",c).css("z-index",a-(o.id-r)):l.removeClass(e).addClass("highlight").css("left",c).css("z-index",1e3):l.addClass("hidden")}},createButtons:function(){var e=o.buttons_style,t="<div class='btn "+e+" left'></div>"+"<div class='btn "+e+" right'></div>";this._element.append(t),this.registerBtnEvents()},registerBtnEvents:function(){var e=this,t=this._element.find(".btn.left"),i=this._element.find(".btn.right");t.bind("click",function(t){t.preventDefault(),e.slide(!1,1)}),i.bind("click",function(t){t.preventDefault(),e.slide(!0,1)})},registerScrollEvents:function(){var e=this,t=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";this._element.bind(t,function(t){var i=window.event||t;i=i.originalEvent?i.originalEvent:i;var a=i.detail?-40*i.detail:i.wheelDelta;0>a?e.slide(!0,1):e.slide(!1,1)})},registerDragEvents:function(){var e=!1,t=null;this._element.bind("mousedown",function(i){e=!0,t=i.offsetX}),this._element.bind("mouseup",function(){e=!1,t=null}),this._element.bind("mousemove",function(){})},registerTouchEvents:function(){},slide:function(e,t){if(!(!e&&0>r-t||e&&r+t>=this._size)){r+=e?t:-t;for(var i=e?-s:s,a=0,n=this._size;n>a;a++){var c=this._items[a];c.leftPosition+=i}o.infinite,this.repaintElements()}}},e.fn.coverFlow=function(e){var t=new i(this,e);t.createWrapper(),t.initElements()}}(jQuery);