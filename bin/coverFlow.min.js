!function(t){function e(e,i){this.id=e,this.src=i,this.leftPosition=e*o,this._cfWrapper=t(".coverFlowWrapper"),this.checkDimensions()}function i(t,e){this.data=e.data,this.width=0,this._element=t,this._items=[],this._size=this.data.length,this._middle=Math.floor(this._size/2),s={infinite:e.infinite||!1,reflection:e.reflection||!1,perspective:e.perspective||600,buttons:e.buttons||!1,height:e.height||450},r=this._middle}var n,o=200,r=0,s={};e.prototype={createDomItem:function(){return"<div class='coverFlowItem c"+this.id+"'>"+"<img src='"+this.src+"' />"+"<canvas></canvas>"+"</div>"},checkDimensions:function(){var e=this,i=new t.Deferred,n=new Image;return n.onload=function(){e._width=this.width,e._height=this.height,e.calculatedWidth=Math.round(this.width*s.height/this.height),i.resolve(e),s.reflection&&e.drawReflection(n)},n.src=this.src,i},drawReflection:function(t){var e,i=this._cfWrapper.find(".c"+this.id).find("canvas")[0],n=i.getContext("2d");i.height=s.height,i.width=this.calculatedWidth,n.drawImage(t,0,0,this.calculatedWidth,s.height),n.globalCompositeOperation="destination-out",e=n.createLinearGradient(0,0,0,s.height),e.addColorStop(0,"rgba(255,255,255,1)"),e.addColorStop(1,"rgba(255,255,255,0.5)"),n.fillStyle=e,n.rect(0,0,this.calculatedWidth,s.height),n.fill()}},i.prototype={createWrapper:function(){var t="<div class='coverFlowWrapper'></div>";this._element.addClass("coverFlow").html(t),this._wrapper=this._element.children(".coverFlowWrapper"),s.buttons&&this.createButtons(),this.registerScrollEvents(),n=this._element.width()},initElements:function(){for(var t="",i=this,o=0,a=this._size;a>o;o++){var l=new e(o,this.data[o]),c=l.createDomItem(),u=0;i._items.push(l),l.checkDimensions().then(function(t){u++,i.width+=t.calculatedWidth;var e=i._wrapper.find(".c"+t.id);t.id<r?e.addClass("leftItem").css({left:t.leftPosition,"z-index":i._size-(r-t.id)}):t.id>r?e.addClass("rightItem").css({left:t.leftPosition,"z-index":i._size-(t.id-r)}):e.addClass("highlight").css({left:t.leftPosition}),u==i._size&&i._wrapper.css({left:n/2-i._items[r].leftPosition,display:"block"})}),t+=c}this._wrapper.html(t),s.reflection||this._wrapper.find("canvas").remove()},repaintElements:function(){for(var t="highlight leftItem rightItem",e=0,i=this._size;i>e;e++){var n=this._items[e],o=this._wrapper.find(".c"+n.id);r>e?o.removeClass(t).addClass("leftItem").css("z-index",i-(r-n.id)):e>r?o.removeClass(t).addClass("rightItem").css("z-index",i-(n.id-r)):o.removeClass(t).addClass("highlight").css("z-index",1e3)}},createButtons:function(){var t="<div class='btn left'></div><div class='btn right'></div>";this._element.append(t),this.registerBtnEvents()},registerBtnEvents:function(){var t=this,e=this._element.find(".btn.left"),i=this._element.find(".btn.right");e.bind("click",function(e){e.preventDefault(),t.slide(!1,1)}),i.bind("click",function(e){e.preventDefault(),t.slide(!0,1)})},registerScrollEvents:function(){var t=this,e=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";this._element.bind(e,function(e){var i=window.event||e;i=i.originalEvent?i.originalEvent:i;var n=i.detail?-40*i.detail:i.wheelDelta;0>n?t.slide(!0,1):t.slide(!1,1)})},registerDragEvents:function(){var t=!1,e=null;this._element.bind("mousedown",function(i){t=!0,e=i.offsetX}),this._element.bind("mouseup",function(){t=!1,e=null}),this._element.bind("mousemove",function(){})},registerTouchEvents:function(){},slide:function(t,e){if(!(!t&&0>r-e||t&&r+e>=this._size)){r+=t?e:-e;var i=n/2-this._items[this._middle].leftPosition+(this._middle-r)*o;this.repaintElements(),this._wrapper.css({left:i})}}},t.fn.coverFlow=function(t){var e=new i(this,t);e.createWrapper(),e.initElements()}}(jQuery);