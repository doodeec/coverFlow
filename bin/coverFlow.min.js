!function(e){function t(t,i){this.id=t,this.src=i,this.leftPosition=t*n,this._cfWrapper=e(".coverFlowWrapper"),this.checkDimensions()}function i(e,t){this.data=t.data,this.width=0,this._element=e,this._items=[],this._size=this.data.length,this._middle=Math.floor(this._size/2),o={infinite:t.infinite||!1,reflection:t.reflection||!1,perspective:t.perspective||600,buttons:t.buttons||!1,buttons_style:t.buttons_style||"dark",height:t.height||450},a=this._middle}var s,n=200,a=0,o={};t.prototype={createDomItem:function(){return"<div class='coverFlowItem c"+this.id+"'>"+"<img src='"+this.src+"' />"+"<canvas></canvas>"+"</div>"},checkDimensions:function(){var t=this,i=new e.Deferred,s=new Image;return s.onload=function(){t._width=this.width,t._height=this.height,t.calculatedWidth=Math.round(this.width*o.height/this.height),i.resolve(t),o.reflection&&t.drawReflection(s)},s.src=this.src,i},drawReflection:function(e){var t,i=this._cfWrapper.find(".c"+this.id).find("canvas")[0],s=i.getContext("2d");i.height=o.height,i.width=this.calculatedWidth,s.drawImage(e,0,0,this.calculatedWidth,o.height),s.globalCompositeOperation="destination-out",t=s.createLinearGradient(0,0,0,o.height),t.addColorStop(0,"rgba(255,255,255,1)"),t.addColorStop(1,"rgba(255,255,255,0.5)"),s.fillStyle=t,s.rect(0,0,this.calculatedWidth,o.height),s.fill()}},i.prototype={createWrapper:function(){var e="<div class='coverFlowWrapper'></div>";this._element.addClass("coverFlow").html(e),this._wrapper=this._element.children(".coverFlowWrapper"),o.buttons&&this.createButtons(),this.registerScrollEvents(),this.registerTouchEvents(),s=this._element.width()},initElements:function(){for(var e="",i=this,n=0,r=this._size;r>n;n++){var l=new t(n,this.data[n]),c=l.createDomItem(),d=0;i._items.push(l),l.checkDimensions().then(function(e){d++,i.width+=e.calculatedWidth;var t=i._wrapper.find(".c"+e.id);e.id<a?t.addClass("leftItem").css({left:e.leftPosition,"z-index":i._size-(a-e.id)}):e.id>a?t.addClass("rightItem").css({left:e.leftPosition,"z-index":i._size-(e.id-a)}):t.addClass("highlight").css({left:e.leftPosition}),d==i._size&&i._wrapper.css({left:s/2-i._items[a].leftPosition,display:"block"})}),e+=c}this._wrapper.html(e),o.reflection||this._wrapper.find("canvas").remove()},repaintElements:function(){for(var e="highlight leftItem rightItem",t=0,i=this._size;i>t;t++){var s=this._items[t],n=this._wrapper.find(".c"+s.id);a>t?n.removeClass(e).addClass("leftItem").css("z-index",i-(a-s.id)):t>a?n.removeClass(e).addClass("rightItem").css("z-index",i-(s.id-a)):n.removeClass(e).addClass("highlight").css("z-index",1e3)}},createButtons:function(){var e=o.buttons_style,t="<div class='btn "+e+" left'></div>"+"<div class='btn "+e+" right'></div>";this._element.append(t),this.registerBtnEvents()},registerBtnEvents:function(){var e=this,t=this._element.find(".btn.left"),i=this._element.find(".btn.right");t.bind("click",function(t){t.preventDefault(),e.slide(!1,1)}),i.bind("click",function(t){t.preventDefault(),e.slide(!0,1)})},registerScrollEvents:function(){var e=this,t=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";this._element.bind(t,function(t){var i=window.event||t;i=i.originalEvent?i.originalEvent:i;var s=i.detail?-40*i.detail:i.wheelDelta;0>s?e.slide(!0,1):e.slide(!1,1)})},registerDragEvents:function(){var e=!1,t=null;this._element.bind("mousedown",function(i){e=!0,t=i.offsetX}),this._element.bind("mouseup",function(){e=!1,t=null}),this._element.bind("mousemove",function(){})},registerTouchEvents:function(){},slide:function(e,t){if(!(!e&&0>a-t||e&&a+t>=this._size)){a+=e?t:-t;var i=s/2-this._items[this._middle].leftPosition+(this._middle-a)*n;this.repaintElements(),this._wrapper.css({left:i})}}},e.fn.coverFlow=function(e){var t=new i(this,e);t.createWrapper(),t.initElements()}}(jQuery);