(function(e){function o(t,n){this.id=t;this.src=n;this.leftPosition=t*r;this._cfWrapper=e(".coverFlowWrapper");this.checkDimensions()}function u(e,t){this.data=t.data;this.width=0;this._element=e;this._items=[];this._size=this.data.length;this._middle=Math.floor(this._size/2);s={infinite:t.infinite||false,reflection:t.reflection||true,perspective:t.perspective||600,buttons:t.buttons||false};i=this._middle}var t,n=450,r=200,i=0,s={};o.prototype={createDomItem:function(){return"<div class='coverFlowItem c"+this.id+"'>"+"<img src='"+this.src+"' />"+"<canvas></canvas>"+"</div>"},checkDimensions:function(){var r=this,i=new e.Deferred;var s=new Image;s.onload=function(){r._width=this.width;r._height=this.height;r.calculatedWidth=Math.round(this.width*n/this.height);i.resolve(r);r.drawReflection(s)};s.src=this.src;return i},drawReflection:function(t){var r=this._cfWrapper.find(".c"+this.id).find("canvas")[0],i=r.getContext("2d"),s;r.height=n;r.width=this.calculatedWidth;i.drawImage(t,0,0,this.calculatedWidth,n);i.globalCompositeOperation="destination-out";s=i.createLinearGradient(0,0,0,n);s.addColorStop(0,"rgba(255,255,255,1)");s.addColorStop(1,"rgba(255,255,255,0.5)");i.fillStyle=s;i.rect(0,0,this.calculatedWidth,n);i.fill()}};u.prototype={createWrapper:function(){var n="<div class='coverFlowWrapper'></div>";this._element.addClass("coverFlow").html(n);this._wrapper=this._element.children(".coverFlowWrapper");if(s.buttons)this.createButtons();this.registerScrollEvents();t=this._element.width()},initElements:function(){var n="",r=this;for(var s=0,u=this._size;s<u;s++){var a=new o(s,this.data[s]),f=a.createDomItem(),l=0;r._items.push(a);a.checkDimensions().then(function(e){l++;r.width+=e.calculatedWidth;var n=r._wrapper.find(".c"+e.id);if(e.id<i){n.addClass("leftItem").css({left:e.leftPosition,"z-index":r._size-(i-e.id)})}else if(e.id>i){n.addClass("rightItem").css({left:e.leftPosition,"z-index":r._size-(e.id-i)})}else{n.addClass("highlight").css({left:e.leftPosition})}if(l==r._size){r._wrapper.css({left:t/2-r._items[i].leftPosition,display:"block"})}});n+=f}this._wrapper.html(n)},repaintElements:function(){var t="highlight leftItem rightItem";for(var n=0,r=this._size;n<r;n++){var s=this._items[n],o=this._wrapper.find(".c"+s.id);if(n<i){if(o.is(":visible")){o.removeClass(t).addClass("leftItem").css("z-index",r-(i-s.id))}}else if(n>i){o.removeClass(t).addClass("rightItem").css("z-index",r-(s.id-i))}else{o.removeClass(t).addClass("highlight").css("z-index",r*2)}}},createButtons:function(){var t="<div class='btn left'></div>"+"<div class='btn right'></div>";this._element.append(t);this.registerBtnEvents()},registerBtnEvents:function(){var t=this,n=this._element.find(".btn.left"),r=this._element.find(".btn.right");n.bind("click",function(e){e.preventDefault().stopPropagation();t.slide(false,1)});r.bind("click",function(e){e.preventDefault().stopPropagation();t.slide(true,1)})},registerScrollEvents:function(){var t=this;var n=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";this._element.bind(n,function(e){var n=window.event||e;n=n.originalEvent?n.originalEvent:n;var r=n.detail?n.detail*-40:n.wheelDelta;r<0?t.slide(true,1):t.slide(false,1)})},registerDragEvents:function(){var t=this,n=false,r=null;this._element.bind("mousedown",function(e){n=true;r=e.offsetX});this._element.bind("mouseup",function(e){n=false;r=null});this._element.bind("mousemove",function(e){if(n){}})},registerTouchEvents:function(){},slide:function(n,s){if(!n&&i-s<0||n&&i+s>=this._size)return;i+=n?s:-s;var o=t/2-this._items[this._middle].leftPosition+(this._middle-i)*r;this.repaintElements();this._wrapper.css({left:o})}};e.fn.coverFlow=function(e){var t=new u(this,e);t.createWrapper();t.initElements()}})(jQuery)